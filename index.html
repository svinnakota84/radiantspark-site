<script>
// ===== Page Navigation with Hash Support =====
function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
function loadPageFromHash() {
    const hash = window.location.hash;
    if (hash === '#real-estate') showPage('real-page');
    else if (hash === '#flip') showPage('flip-page');
    else showPage('it-page');
}
window.addEventListener('hashchange', loadPageFromHash);
window.addEventListener('load', loadPageFromHash);

// ===== REAL Free ChatGPT Integration (Updated Proxy + FIXED) =====
const toggle = document.getElementById('chat-toggle');
const chatbox = document.getElementById('chatbox');
const closeBtn = document.getElementById('chat-close');
const form = document.getElementById('chatbox-form');
const input = document.getElementById('chatbox-input');
const messages = document.getElementById('chatbox-messages');

toggle.addEventListener('click', () => {
    if (chatbox.style.display === 'none' || chatbox.style.display === '') {
        chatbox.style.display = 'flex';
    } else {
        chatbox.style.display = 'none';
    }
});
closeBtn.addEventListener('click', () => chatbox.style.display = 'none');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userMessage = input.value.trim();
    if (!userMessage) return;

    messages.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;
    input.value = '';
    messages.scrollTop = messages.scrollHeight;

    const typing = document.createElement('p');
    typing.innerHTML = `<em><strong>AI:</strong> Thinking...</em>`;
    messages.appendChild(typing);
    messages.scrollTop = messages.scrollHeight;

    try {
        const response = await fetch("https://api.pawan.krd/openai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer free"
            },
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                    { role: "system", content: "You are a friendly and helpful AI assistant for Radiant Spark LLC." },
                    { role: "user", content: userMessage }
                ],
                temperature: 0.7,
                max_tokens: 500
            })
        });

        const data = await response.json();
        typing.remove();

        // SAFELY HANDLE ERRORS
        let aiReply = "Sorry, I couldn't respond right now. Please try again later.";

        if (data?.choices && data.choices.length > 0) {
            aiReply = data.choices[0].message.content;
        } else if (data?.error?.message) {
            aiReply = "AI Error: " + data.error.message;
        }

        messages.innerHTML += `<p><strong>AI:</strong> ${aiReply}</p>`;
    } catch (err) {
        typing.remove();
        messages.innerHTML += `<p><strong>AI:</strong> Connection issue. Please try again.</p>`;
        console.error("Chat Error:", err);
    }

    messages.scrollTop = messages.scrollHeight;
});
</script>

